#!/bin/sh

C_FZF_CMD="${C_FZF_CMD:=fzf --preview= --delimiter=\/ --with-nth=-1}"
C_EDITOR_CMD="${C_EDITOR_CMD:-$EDITOR}"
if [ -z "$C_EDITOR_CMD" ]; then
    echo "C_EDITOR_CMD and EDITOR variables are not set"
    exit 1
fi

ZDOTDIR="${ZDOTDIR:-$HOME/.config/zsh}"
if [ ! -d "$ZDOTDIR" ]; then
    echo "ZDOTDIR is not set or $ZDOTDIR doesn't exist"
    exit 1
fi

if [ $(find "$ZDOTDIR" -maxdepth 1 -type f \
    -not -name '.*' -print -quit 2>/dev/null | wc -l) -eq 0 ]; then
    echo "$ZDOTDIR is empty"
    exit 1
fi

set -- --header='Edit .zshrc by default'
choice="$(find -L "$ZDOTDIR" -maxdepth 1 -type f -not -name '.*' | $C_FZF_CMD "$@")"

eval "$C_EDITOR_CMD ${choice:=$ZDOTDIR/.zshrc}"
